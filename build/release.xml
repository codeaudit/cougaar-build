<project name="release" default="dist" basedir=".">
<!-- release builder: builds entire COUGAAR releases
parameters:
	basedir		head of checked-out source/build tree

Usage: ant -buildfile build/release.xml -Dbasedir=$PWD dist

-->

<!--
	The following are cougaar ANT extensions which require that antex
	be compiled and installed into the ant lib directory as cougaar.jar
-->
<taskdef name="pathproperty" classname="org.cougaar.tools.ant.PathProperty"/>
<taskdef name="trycall" classname="org.cougaar.tools.ant.TryCall"/>
<taskdef name="foreach" classname="org.cougaar.tools.ant.Foreach"/>

<!-- set global properties from user's .ant.properties file -->
<property file="${user.home}/.ant.properties"/>

<property name="module.xml" value="${basedir}/build/buildm.xml"/>

<property name="tmpdir" value="${basedir}/tmpdir"/>
<property name="distdir" value="${tmpdir}/dist"/>

<property name="project.classlib" value="${distdir}/lib"/>


<target name="init">
</target>


<target name="dist" depends="init">
  <mkdir dir="${distdir}"/>
  <mkdir dir="${distdir}/lib"/>


  <!-- now dist the modules -->
  <antcall target="dist.module">
    <param name="module" value="build"/>
  </antcall>

  <antcall target="dist.module">
    <param name="module" value="javaiopatch"/>
  </antcall>

  <antcall target="dist.module">
    <param name="module" value="core"/>
  </antcall>

  <antcall target="dist.module">
    <param name="module" value="toolkit"/>
  </antcall>
  <antcall target="dist.module">
    <param name="module" value="planserver"/>
  </antcall>
  <antcall target="dist.module">
    <param name="module" value="glm"/>
  </antcall>
  <antcall target="dist.module">
    <param name="module" value="contract"/>
  </antcall>
  <antcall target="dist.module">
    <param name="module" value="scalability"/>
  </antcall>

  <antcall target="dist.module">
    <param name="module" value="server"/>
  </antcall>

  <antcall target="dist.module">
    <param name="module" value="tutorial"/>
  </antcall>

  <antcall target="dist.module">
    <param name="module" value="configgen"/>
  </antcall>

  <!-- touch-ups -->

  <mkdir dir="${distdir}/bin"/>
  <copy todir="${distdir}/bin">
    <fileset dir="${distdir}/glm/bin" />
  </copy>

  <mkdir dir="${distdir}/configs"/>
  <copy todir="${distdir}/configs">
    <fileset dir="${distdir}/glm/configs" />
  </copy>

</target>

<target name="dist.module">
  <!-- requires that ${module} be set -->
  <ant antfile="${module.xml}" target="dist" dir="${basedir}/${module}">
    <property name="module.name" value="${module}"/>
    <property name="codegen.jar" value="${distdir}/lib/build.jar"/>
  </ant>
  
  <copy todir="${distdir}">
    <fileset dir="${basedir}/${module}/tmpdir/dist"/>
  </copy>
</target>

<target name="clean">
  <!-- now dist the modules -->
  <antcall target="clean.module">
    <param name="module" value="build"/>
  </antcall>
  <antcall target="clean.module">
    <param name="module" value="javaiopatch"/>
  </antcall>
  <antcall target="clean.module">
    <param name="module" value="core"/>
  </antcall>
  <antcall target="clean.module">
    <param name="module" value="toolkit"/>
  </antcall>
  <antcall target="clean.module">
    <param name="module" value="planserver"/>
  </antcall>
  <antcall target="clean.module">
    <param name="module" value="glm"/>
  </antcall>
  <antcall target="clean.module">
    <param name="module" value="contract"/>
  </antcall>
  <antcall target="clean.module">
    <param name="module" value="scalability"/>
  </antcall>
  <antcall target="clean.module">
    <param name="module" value="server"/>
  </antcall>
  <antcall target="clean.module">
    <param name="module" value="tutorial"/>
  </antcall>
  <antcall target="clean.module">
    <param name="module" value="configgen"/>
  </antcall>

  <!-- Delete the ${tmpdir} and ${dist} directory trees -->
  <delete dir="${tmpdir}" />
</target>

<target name="clean.module">
  <!-- requires that ${module} be set -->
  <ant antfile="${module.xml}" target="clean" dir="${basedir}/${module}">
    <property name="module.name" value="${module}"/>
    <property name="codegen.jar" value="${distdir}/lib/build.jar"/>
  </ant>
</target>


</project>
